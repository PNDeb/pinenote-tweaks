
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.2.5">
    
    
      
        <title>My Docs</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#debian-trixie-for-the-pine64-pinenote" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Debian Trixie for the Pine64 PineNote
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Debian Trixie for the Pine64 PineNote
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Debian Trixie for the Pine64 PineNote
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-to-get-help" class="md-nav__link">
    Where to get help
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updates" class="md-nav__link">
    Updates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-another-partition-for-home" class="md-nav__link">
    Using another partition for /home
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-do-i" class="md-nav__link">
    How do I
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation-for-appssystems" class="md-nav__link">
    Documentation for apps/systems
  </a>
  
    <nav class="md-nav" aria-label="Documentation for apps/systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wakeup-sources" class="md-nav__link">
    Wakeup-Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sleep-sources" class="md-nav__link">
    Sleep sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ble-pen-buttons" class="md-nav__link">
    BLE Pen (Buttons)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ebc-kernel-driver" class="md-nav__link">
    EBC Kernel Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview-of-modulesysfs-parameters" class="md-nav__link">
    Overview of module/sysfs-parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#black-and-white-mode" class="md-nav__link">
    Black and White mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-refresh" class="md-nav__link">
    Auto Refresh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#waveforms" class="md-nav__link">
    Waveforms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trimming-the-a2-waveform" class="md-nav__link">
    Trimming the A2 waveform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xournalppwriting" class="md-nav__link">
    Xournalpp/Writing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-not-working" class="md-nav__link">
    What is not working?
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where-to-get-help" class="md-nav__link">
    Where to get help
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updates" class="md-nav__link">
    Updates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-another-partition-for-home" class="md-nav__link">
    Using another partition for /home
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-do-i" class="md-nav__link">
    How do I
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation-for-appssystems" class="md-nav__link">
    Documentation for apps/systems
  </a>
  
    <nav class="md-nav" aria-label="Documentation for apps/systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wakeup-sources" class="md-nav__link">
    Wakeup-Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sleep-sources" class="md-nav__link">
    Sleep sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ble-pen-buttons" class="md-nav__link">
    BLE Pen (Buttons)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ebc-kernel-driver" class="md-nav__link">
    EBC Kernel Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview-of-modulesysfs-parameters" class="md-nav__link">
    Overview of module/sysfs-parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#black-and-white-mode" class="md-nav__link">
    Black and White mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-refresh" class="md-nav__link">
    Auto Refresh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#waveforms" class="md-nav__link">
    Waveforms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trimming-the-a2-waveform" class="md-nav__link">
    Trimming the A2 waveform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xournalppwriting" class="md-nav__link">
    Xournalpp/Writing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-not-working" class="md-nav__link">
    What is not working?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="debian-trixie-for-the-pine64-pinenote">Debian Trixie for the Pine64 PineNote<a class="headerlink" href="#debian-trixie-for-the-pine64-pinenote" title="Permanent link">#</a></h1>
<p>TOC:</p>
<ul>
<li>Getting started</li>
<li>Troubleshooting</li>
<li>How do I...</li>
</ul>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>Hi there, nice of you to install this Debian image on your PineNote!</p>
<p>Before you begin, please bear in mind that the PineNote, and this image, is
aimed a experienced users and developers, and many things need manual tweaking
or do not just work yet.
However, many things also work, and you can take control of quite a lot of
things.
If you have not done this yet, we strongly recommend to at least skim this
document before proceeding to use your PineNote.</p>
<p>If you want to improve this text, merge requests are very very much appreciated!</p>
<p><a href="https://github.com/PNDeb/pinenote-tweaks/tree/main/pn_handbook">Improve on github</a></p>
<h2 id="where-to-get-help">Where to get help<a class="headerlink" href="#where-to-get-help" title="Permanent link">#</a></h2>
<p>Remember, software for the PineNote is created by the community, for the
community!</p>
<p>Probably the best and fastest way to get help is to join the PineNote chat via
Matrix, irc, or Discord. Please refer to the wiki page for more information on
chats and forums: <a href="https://wiki.pine64.org/wiki/Main_Page#Community_and_Support">Pine64
Wiki</a>.</p>
<h2 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">#</a></h2>
<ul>
<li>
<p>User/Password: You are logged in as user "user" with password "1234". sudo is
  activated. We suggest to set a root password:</p>
<p>sudo su - root
passwd</p>
</li>
<li>
<p>The <strong>Documents/</strong> directory contains one sample .pdf and one .epub file. Try
  opening them and start reading!</p>
</li>
<li>
<p>You may want (should!) to reconfigure your locales:</p>
<p>sudo dpkg-reconfigure locales</p>
</li>
<li>
<p>The status bar at the top contains the refresh button and the PineNote-Helper
  Gnome extension, which helps you to control some aspects of the eink display.
  Both of these items will become important for an effective use of the
  PineNote in a Gnome environment.</p>
</li>
</ul>
<h2 id="updates">Updates<a class="headerlink" href="#updates" title="Permanent link">#</a></h2>
<p>Apart from a number of tweaks aimed at producing an improved user experience on
the PineNote, and a few patched packages, you are running a Debian Bookworm
operating system which can be maintained as very other system. Use apt or
aptitude to manage you packages.</p>
<p>A PineNote package repository is in its early testing phase, and should be
configured by default in this installation. For manual configuration of the
repository, please refer to <a href="https://github.com/PNDeb/pinenote-debian-image/tree/dev#pinenote-specific-debian-repository">this part of the image
Readme.</a></p>
<h2 id="using-another-partition-for-home">Using another partition for /home<a class="headerlink" href="#using-another-partition-for-home" title="Permanent link">#</a></h2>
<p>Depending on the method of installation, /home is located on the root
partition, which is quite small in size (check by analysing the output of the
<em>mount</em> command).
However, a bash script is
provided in <code>/root/switch_home_to_other_partition.sh</code> which can be used to
change the partition that is used for /home. The script can also transfer data
from the current /home to the new partition. Call as root.</p>
<p>Example to switch /home to /dev/mmcblk0p19:</p>
<pre><code>cd /root
switch_home_to_other_partition.sh /dev/mmcblk0p19
</code></pre>
<h2 id="how-do-i">How do I<a class="headerlink" href="#how-do-i" title="Permanent link">#</a></h2>
<ul>
<li><strong>Read a book (epub)/pdf</strong>:<ul>
<li>Koreader is already installed and should be registered for corresponding
  file types</li>
<li>?</li>
</ul>
</li>
<li><strong>Take notes</strong>: Xournalpp was slightly modified to provide an improved
  experience on the Pinenote.
  Other note-taking apps to test/consider:<ul>
<li>https://github.com/saber-notes/</li>
<li>rnote</li>
<li>syioek (???)</li>
</ul>
</li>
<li><strong>Use the Pinenote as an external screen?</strong>:<ul>
<li>(untested) The Weylus project could be of help: https://github.com/H-M-H/Weylus</li>
</ul>
</li>
<li><strong>Use an external monitor with the Pinenote?</strong>: TODO (won't directly work,
  need something like vnc and virtual monitor)<ul>
<li>(untested) The Weylus project could be of help: https://github.com/H-M-H/Weylus</li>
</ul>
</li>
</ul>
<h2 id="documentation-for-appssystems">Documentation for apps/systems<a class="headerlink" href="#documentation-for-appssystems" title="Permanent link">#</a></h2>
<h3 id="wakeup-sources">Wakeup-Sources<a class="headerlink" href="#wakeup-sources" title="Permanent link">#</a></h3>
<ul>
<li>Cover</li>
<li>Bluetooth</li>
<li>Power cable</li>
<li>Button</li>
<li>Touch screen</li>
</ul>
<h3 id="sleep-sources">Sleep sources<a class="headerlink" href="#sleep-sources" title="Permanent link">#</a></h3>
<ul>
<li>PWR-Button-press</li>
<li>Pen-Button-Press</li>
</ul>
<h3 id="ble-pen-buttons">BLE Pen (Buttons)<a class="headerlink" href="#ble-pen-buttons" title="Permanent link">#</a></h3>
<p>The PineNote Pen interfaces with the PineNote using two interfaces:</p>
<ul>
<li>The stylus input is one using the touchscreen (cyttsp5 driver),</li>
<li>on the other hand, the three buttons are controlled via a separate
  Bluetooth-Low-Energy-based connection.</li>
</ul>
<p>A driver for the BLE-button interface was developed by smaeul
    (https://github.com/smaeul/linux/commits/rk356x-ebc-dev).</p>
<p>The hardware contains non-volatile storage for the MAC address - it could be
that the pen just works. Otherwise, as root, connect manually:</p>
<pre><code>echo 1 &gt; /sys/bus/spi/devices/spi4.0/scan; # scanning takes ca. 12 seconds
                                         # press the buttons during scanning
# print MAC address pen
cat /sys/bus/spi/devices/spi4.0/scan
echo [MAC] &gt; /sys/bus/spi/devices/spi4.0/pen_address
</code></pre>
<p>Afterwards, check that the pen is working by checking the pen attributes:</p>
<pre><code>cat /sys/bus/spi/devices/spi4.0/pen_version
cat /sys/bus/spi/devices/spi4.0/pen_battery
</code></pre>
<h3 id="ebc-kernel-driver">EBC Kernel Driver<a class="headerlink" href="#ebc-kernel-driver" title="Permanent link">#</a></h3>
<p>The EBC subsystem controls the eink (or epd) display and is one of components
which require most tweaking for each user.</p>
<pre><code>* ioctls

    * trigger global refresh
    * set offline-screen
    * [to implement] set standby screen mask &amp; behavior
* misc:

    * discuss the waveform-switching issues in a general DE environment:
      recommend to always do a global refresh after switching waveforms,
      unless you know that your buffer is compatible
</code></pre>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h3>
<p>All module parameters are controlled using the sysfs parameters in
/sys/module/rockchip_ebc/parameters</p>
<p>The module parameters can also be set on module load time, for example using
the modprobe configuration file:</p>
<pre><code>root@pinenote:~# cat /etc/modprobe.d/rockchip_ebc.conf
options rockchip_ebc direct_mode=0 auto_refresh=1 split_area_limit=0 panel_reflection=1
</code></pre>
<p>By default the parameters in /sys/module/rockchip_ebc/parameters need to be
writen to as root, but this can be easily changed via udev rules.</p>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">#</a></h3>
<p>Newer versions of the kernel driver use the (dynamic debug
feature)[https://www.kernel.org/doc/html/latest/admin-guide/dynamic-debug-howto.html]
of the linux kernel.</p>
<p>As root, the following commands should get you going. Note that the line
numbers can change between kernel releases! Check the output of <code>cat control |
grep rockchip_ebc</code></p>
<pre><code>cd /sys/kernel/debug/dynamic_debug/
# lists all debug outputs available for the module
cat control  | grep rockchip_ebc
# now we can activate/disable individual debug statements
echo -n 'file drivers/gpu/drm/rockchip/rockchip_ebc.c line 1289 +p' &gt; control
# list currently active (=p) debug statements
cat control  | grep rockchip_ebc | grep " =p "
</code></pre>
<h3 id="overview-of-modulesysfs-parameters">Overview of module/sysfs-parameters:<a class="headerlink" href="#overview-of-modulesysfs-parameters" title="Permanent link">#</a></h3>
<ul>
<li>TODO</li>
<li><strong>split_area_limit</strong> split_area_limit denotes the number of splits that the
  driver is allowed to apply to individual clips. The idea is: when you submit
  two damage regions for drawing, and both regions overlap, and the first one
  already started, then it sometimes makes sense to split the second area into
  four smaller regions, from which three can already start drawing. This is
  really useful for writing applications where there is usually a little bit of
  overlap between subsequent drawing areas</li>
</ul>
<p>In addition, two custom ioctls are currently implemented for the ebc driver:</p>
<ul>
<li>TODO</li>
</ul>
<h3 id="black-and-white-mode">Black and White mode<a class="headerlink" href="#black-and-white-mode" title="Permanent link">#</a></h3>
<p>Activate with</p>
<pre><code>echo 1 &gt; /sys/module/rockchip_ebc/parameters/bw_mode
</code></pre>
<p>the threshold value can be set using:</p>
<pre><code>echo 7 &gt; /sys/module/rockchip_ebc/parameters/bw_threshold
</code></pre>
<p>7 is the default value, meaning that all pixel values lower than 7 will be cast
to 0 (black) and all values larger than, or equal to, 7 will be cast to 15
(white).</p>
<h3 id="auto-refresh">Auto Refresh<a class="headerlink" href="#auto-refresh" title="Permanent link">#</a></h3>
<p>Enabling automatic global (full screen) refreshes:</p>
<pre><code>echo 1 &gt; /sys/module/rockchip_ebc/parameters/auto_refresh
</code></pre>
<p>Global refreshes are triggered based on the area drawing using partial
refreshes, in units of total screen area.</p>
<pre><code>echo 2 &gt; /sys/module/rockchip_ebc/parameters/refresh_threshold
</code></pre>
<p>therefore will trigger a globlal refresh whenever 2 screen areas where drawn.</p>
<p>The threshold should be set according to the application used. For example,
evince and xournalpp really like to redraw the screen very often, so a value of
20 suffices.
Other require lower numbers.</p>
<p>The waveform to use for global refreshes can be set via</p>
<pre><code>echo 4 &gt; /sys/module/rockchip_ebc/parameters/refresh_waveform
</code></pre>
<p>A value of 4 is the default.</p>
<h3 id="waveforms">Waveforms<a class="headerlink" href="#waveforms" title="Permanent link">#</a></h3>
<ul>
<li>
<p>the <strong>default_waveform</strong> parameter controls which waveform is used. Based on
  information from include/drm/drm_epd_helper.h, the integer values are
  associated with the following waveforms:</p>
<pre><code>0: @DRM_EPD_WF_RESET: Used to initialize the panel, ends with white
1: @DRM_EPD_WF_A2: Fast transitions between black and white only
2: @DRM_EPD_WF_DU: Transitions 16-level grayscale to monochrome
3: @DRM_EPD_WF_DU4: Transitions 16-level grayscale to 4-level grayscale
4: @DRM_EPD_WF_GC16: High-quality but flashy 16-level grayscale
5: @DRM_EPD_WF_GCC16: Less flashy 16-level grayscale
6: @DRM_EPD_WF_GL16: Less flashy 16-level grayscale
7: @DRM_EPD_WF_GLR16: Less flashy 16-level grayscale, plus anti-ghosting
8: @DRM_EPD_WF_GLD16: Less flashy 16-level grayscale, plus anti-ghosting
</code></pre>
</li>
<li>
<p>(side note): Based on information from drivers/gpu/drm/drm_epd_helper.c, the
  Pinenote uses eps lut form 0x19, which associated waveform types with the
  luts stored in the file as:</p>
<pre><code>.versions = {
    0x19,
    0x43,
},
.format = DRM_EPD_LUT_5BIT_PACKED,
.modes = {
    [DRM_EPD_WF_RESET]  = 0,
    [DRM_EPD_WF_DU]     = 1,
    [DRM_EPD_WF_DU4]    = 7,
    [DRM_EPD_WF_GC16]   = 2,
    [DRM_EPD_WF_GL16]   = 3,
    [DRM_EPD_WF_GLR16]  = 4,
    [DRM_EPD_WF_GLD16]  = 5,
    [DRM_EPD_WF_A2]     = 6,
    [DRM_EPD_WF_GCC16]  = 4,
},
</code></pre>
</li>
</ul>
<p>For example, if you want to inspect/modify the A2 waveform, this corresponds
  to the 7th waveform in the lut file (index 6), but is activated via
  <strong>default_waveoform</strong> by writing value 1.</p>
<h3 id="trimming-the-a2-waveform">Trimming the A2 waveform<a class="headerlink" href="#trimming-the-a2-waveform" title="Permanent link">#</a></h3>
<p>You can trim the A2 waveform for improved writing performance, with the
downside that black sometimes is displayed in gray tones.</p>
<p>The supplied script is very slow and unoptimized and therefore not run
automatically (run time on pinenote ca. 20 minutes).</p>
<p>Call these command in a root shell to trim the A2 waveform (note: this will
reboot the pinenote once):</p>
<pre><code>cd /root
# this command should take ca. 20 minutes !!!
time python3 parse_waveforms_and_modify.py
# save the original waveforms for later use
mv /lib/firmware/rockchip/ebc.wbf /lib/firmware/rockchip/ebc_orig.wbf
ln -s /lib/firmware/rockchip/ebc_modified.wbf /lib/firmware/rockchip/ebc.wbf
update-initramfs -u -k all
reboot
</code></pre>
<h3 id="xournalppwriting">Xournalpp/Writing<a class="headerlink" href="#xournalppwriting" title="Permanent link">#</a></h3>
<ul>
<li>At this point, despite disabling animations, GNOME still shows the spinning
  animation in the panel when xournalpp is started. This prevents proper and
  fast drawing of screen regions. For best experience, wait until the loading
  animation stops before you start drawing/writing.</li>
<li>Switch to "BW+Dither" mode when working in Xpp</li>
<li>The default configuration uses evsieve to merge events from the pen (for
  drawing) and the pen buttons. This is a solution to the problem that the pen
  input and the pen buttons are completely independent systems and therefore
  register as different inputs in the system.</li>
</ul>
<p>The evsieve solution add something like 15 ms lag to the input (according to
  the evsieve readme). You can disable this approach by running (in a root
  shell):</p>
<pre><code>systemctl stop evsieve.service
systemctl disable evsieve.service
</code></pre>
<p>Make sure to restart Xpp and to reconfigure the input sources in the
  settings.
* By default the touch screen is disabled as an input for Xpp. You need to
  activate it in the settings in order to scroll using touch gestures.
* If the pen buttons are configured, holding down the button nearest to the tip
  should allow you to scroll using the pen.
* (depending on XPP version) After both pen and touch scrolling a global
  refresh is triggered
* Kinetic scrolling needs to be disabled because GTK3's implementation
  interferes with some aspect of touch input handling, including touch cancel
  events</p>
<h2 id="what-is-not-working">What is not working?<a class="headerlink" href="#what-is-not-working" title="Permanent link">#</a></h2>
<p>In general, for an up-to-date list of open issues, refer to PNDEB-issue
tracker. TODO</p>
<ul>
<li>
<p>Open Issues</p>
<ul>
<li>Gnome extension: There are issues when suspend/screen blanking (i.e.,
  unloading of the extension is broken)</li>
<li>EBC artifacting</li>
<li>Cover detection ?</li>
<li>Resume/suspend</li>
<li>BT Issues (link to probably-working firmware?)</li>
</ul>
</li>
</ul>
<h1 id="topics">Topics<a class="headerlink" href="#topics" title="Permanent link">#</a></h1>
<ul>
<li>
<p>DBUS service</p>
<ul>
<li>contrl ebc driver</li>
<li>[to implement] handle pen pairing/unpairing</li>
</ul>
</li>
<li>
<p>The GNOME extension</p>
</li>
<li>Pen</li>
<li>Blocked packages &amp; updates</li>
<li>Resources</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.bd0b6b67.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>